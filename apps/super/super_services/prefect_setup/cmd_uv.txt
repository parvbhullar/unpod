# ============================================================
# UV-based Deployment Commands
# ============================================================
# Prerequisites: install uv on server
#   curl -LsSf https://astral.sh/uv/install.sh | sh
# ============================================================


# Local
# -----

docker compose -f super_services/prefect_setup/local/docker-compose-local-base.yaml down --remove-orphans
docker compose -f super_services/prefect_setup/local/docker-compose-local-base.yaml up -d

docker compose -f super_services/prefect_setup/local/docker-call-worker-compose.yaml down --remove-orphans
docker compose -f super_services/prefect_setup/local/docker-call-worker-compose.yaml up -d

# Build voice executor image
docker build -t voice-executor:local .

# Run voice executor locally
uv run python super_services/orchestration/executors/voice_executor_v3.py dev

# Create deployments
uv run python super_services/orchestration/task/deployments/task_deployments.py



# QA
# -----
cd /var/apps/super-qa-prefect

git pull
uv sync --frozen --no-dev

docker compose -f super_services/prefect_setup/qa/docker-compose-qa.yaml down --remove-orphans
docker compose -f super_services/prefect_setup/qa/docker-compose-qa.yaml up -d

docker compose -f super_services/prefect_setup/qa/docker-call-worker-compose.yaml down --remove-orphans
docker compose -f super_services/prefect_setup/qa/docker-call-worker-compose.yaml up -d

# Build voice executor image
docker build -t voice-executor:qa .

# Run voice executor (bare-metal)
uv run python super_services/orchestration/executors/voice_executor_v3.py qa

# Or run via systemd (uses venv directly)
# ExecStart=/var/apps/super-qa-prefect/.venv/bin/python super_services/orchestration/executors/voice_executor_v3.py qa

# Create deployments
uv run python super_services/orchestration/task/deployments/task_deployments.py



# Prod
# -----
cd /var/apps/super-prefect-prod

git pull
uv sync --frozen --no-dev

docker compose -f super_services/prefect_setup/prod/docker-prefect-sever-compose.yaml down --remove-orphans
docker compose -f super_services/prefect_setup/prod/docker-prefect-sever-compose.yaml up -d

docker compose -f super_services/prefect_setup/prod/docker-call-worker-compose.yaml down --remove-orphans
docker compose -f super_services/prefect_setup/prod/docker-call-worker-compose.yaml up -d

# Build voice executor image
docker build -t voice-executor:prod .

# Run voice executor (bare-metal)
uv run python super_services/orchestration/executors/voice_executor_v3.py prod

# Or run via systemd (uses venv directly)
# ExecStart=/var/apps/super-prefect-prod/.venv/bin/python super_services/orchestration/executors/voice_executor_v3.py prod

# Create deployments
uv run python super_services/orchestration/task/deployments/task_deployments.py
